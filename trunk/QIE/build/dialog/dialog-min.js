(function(d){var e=Object.prototype.toString;function a(f){f.style.display="block"}function c(f){f.style.display="none"}function b(h,g){var f=this;if(!(f instanceof b)){return new b(h,g)}this.init(h,g)}d.mix(b,{close:function(g,f){var g=g||"v-dialog",f=f||"dialog-close-handle",h=d.getECN(d.$(g),f,"*");h.length!=0&&h[0].onclick()},remind:function(g,f){f.btnSl=1;this.prompt(g,f)},prompt:function(n,o){var h=o.text||"\u786e\u5b9a",i=o.text2||"\u53d6\u6d88",j="<p>"+n+'</p><div class="tal"><input class="btn primary" value="'+h+'" type="button" />',g=o.textback||function(){},f=o.textback2||function(){},m,l,k=o.btnSl||2;if(k==2){j+='<input class="btn secondary" value="'+i+'" type="button" />'}j+="</div>";m=b(j,o);l=d.$("v-dialog");d.on(d.getECN(l,"primary","input")[0],"click",function(){g.call(m)!==false&&b.close()});if(k==2){d.on(d.getECN(l,"secondary","input")[0],"click",function(){f.call(m)!==false&&b.close()})}},ajax:function(f,g){if(!d.ajax){alert("\u7f3a\u5c11ajax\u6a21\u5757");return false}b(g.ajaxLoading||"ajax\u9875\u9762\u6b63\u5728\u52a0\u8f7d\u4e2d",g);d.ajax(f,{method:"get",loadFun:function(h){b(h.responseText,g)}})},iframe:function(f,h){if(!d.iframeLoad){alert("\u7f3a\u5c11iframeLoad\u6a21\u5757");return false}var i=b('<p id="dialog-iframe-loading">\u52a0\u8f7d\u4e2d.....</p><iframe id="dialog_iframe" src="'+f+'" name="dialog_iframe" class="iframe-hidden" name="dialog_iframe" width="100%" frameborder="no" scrolling="no" frameborder="0" marginheight="0" marginwidth="0"></iframe>',h),g=d.$("dialog_iframe");d.iframeLoad(g,function(){g.style.height=this.newHeight;d.$("dialog-iframe-loading").style.display="none";i.setPosition()});g.src=f},img:function(g,h){b(h.imgLoading||"\u56fe\u7247\u6b63\u5728\u52a0\u8f7d\u4e2d",h);var f=new Image();f.onload=function(){!h.width&&(h.width=this.width+52);b('<img src="'+g+'" alt="" style="width:'+(h.width-52)+'px" />',h)};f.src=g}});b.prototype={init:function(h,g,f){var i=this;this.elem=h;this.openBack=g.openBack;this.closeBack=g.closeBack||function(){};this.top=g.top;this.left=g.left;this.height=g.height;this.width=parseInt(g.width);this.title=g.title;this.type=g.type||"default";this.closeName=g.closeName||"dialog-close-handle";this.Layer=g.Layer===f?1:g.Layer;this.fix=g.fix;this.opacity=g.opacity||0.5;this.autoClose=g.autoClose;this.dragKey=g.dragKey;this.dragTrigger=g.dragTrigger;this.d=document;this.db=this.d.body;this.dd=this.d.documentElement;this.dialogInit();this.open();if(this.dragKey){this.drag()}d.on(window,"resize",this.resize=function(){i.setPosition.call(i)})},shadingLayer:function(){var g,f;if(!d.$("layDic")){var h=document.createDocumentFragment();g=document.createElement("div");g.setAttribute("id","layDic");f=document.createElement("iframe");f.setAttribute("id","layDic-iframe");f.setAttribute("frameborder","0");f.setAttribute("marginheight","0");f.setAttribute("marginwidth","0");g.style.cssText="opacity:0.5;background:#000;position:absolute;top:0;left:0;z-index:9998;display:none";f.style.cssText="opacity:0;-moz-opacity:0;filter:alpha(opacity=0);background:#000;position:absolute;top:0;left:0;z-index:9997;display:none";h.appendChild(g);h.appendChild(f);document.body.appendChild(h)}g=this.layDic=d.$("layDic");f=this.iframe=d.$("layDic-iframe");g.style.filter="alpha(opacity="+this.opacity*100+")";g.style.opacity=this.opacity},dialogInit:function(){var g,q=this,k,h,o,m,r=this.title,j=d.$(this.elem);if(this.type==="duli"){k=this.dialog=d.$(this.elem)}else{if(!d.$("v-dialog")){var n,f;n='<div id="v-dialog" class="dialog dialog-b"><div class="dialog-hd dialog-bk"><span class="dhd-1"><span class="dhd-2"></span></span><b></b><s></s></div><div class="dialog-bd"><div class="dialog-wrap"><div class="dialog-main"><div class="dialog-mbd"></div></div></div><div class="dialog-lf"></div><div class="dialog-rg"></div></div><div class="dialog-close"><a href="#" class="dialog-close-handle" title="\u5173\u95ed">&times;</a></div><b class="jt" style="left:30px"></b><div class="dialog-ft dialog-bk"><span class="dhd-1"><span class="dhd-2"></span></span><b></b><s></s></div></div>';f=document.createElement("div");f.innerHTML=n;document.body.appendChild(f.firstChild)}k=this.dialog=d.$("v-dialog");dialogmain=d.getECN(k,"dialog-main","div")[0];dialogbd=d.getECN(k,"dialog-mbd","div")[0];dialoghd=d.getECN(k,"dialog-mhd","div")[0];dialogbd.innerHTML="";if(r){!dialoghd&&(function(){var i,s;s='<div class="dialog-mhd"></div>';i=document.createElement("div");i.innerHTML=s;dialoghd=i.firstChild;dialogmain.insertBefore(i.firstChild,dialogbd)})();dialoghd.innerHTML=r}else{dialoghd&&dialoghd.parentNode.removeChild(dialoghd)}if(j){a(j);dialogbd.appendChild(j)}else{dialogbd.innerHTML=this.elem}this.dragTrigger=dialoghd;this.dragKey?(dialoghd.style.cursor="move"):(dialoghd.style.cursor="")}d.setStyle(k,{width:this.width+"px","z-index":"9999",display:"none"});g=d.getECN(k,this.closeName,"*");for(var l=0,p=g.length;l<p;l++){g[l].onclick=function(){q.close.call(q);return false}}},fixed:function(g){var f=this.dialog;if(d.Browser.isIE6){var h=this.top!==g?parseInt(this.top):this.cTop;var i=";top:expression(documentElement.scrollTop+"+h+");)";f.style.position="absolute";f.style.cssText+=i;document.body.style.cssText+=";background:url(about:blank) fixed"}else{d.setStyle(f,{position:"fixed",top:this.top!==g?(parseInt(this.top)+"px"):this.cTop+"px"})}return this},unfixed:function(g){var f=this.dialog;d.setStyle(f,{position:"absolute",top:this.top!==g?(parseInt(this.top)+"px"):(Math.max(this.dd.scrollTop,this.db.scrollTop)+this.cTop+"px")})},setPosition:function(j){var h=this.dialog,k,i,f=this.db.scrollWidth,g=this.db.scrollHeight;if(this.Layer){this.shadingLayer();k=this.layDic;i=this.iframe;k.style.width=i.style.width=f+"px";k.style.height=i.style.height=g+"px";a(k);a(i)}a(this.dialog);this.pHeight=this.height?parseInt(this.height):h.offsetHeight;this.cTop=(this.dd.clientHeight-this.pHeight)*0.382;if(this.cTop<0){this.cTop=0}this.fix?this.fixed():this.unfixed();h.style.left=this.left!==j?(parseInt(this.left)+"px"):((this.dd.clientWidth-this.width)/2+"px")},open:function(){var f=this;this.setPosition();if(this.autoClose){this.autoCloseTime&&clearTimeout(this.autoCloseTime);this.autoCloseTime=setTimeout(function(){f.close()},this.autoClose)}e.call(this.openBack)==="[object Function]"&&this.openBack()},close:function(){if(e.call(this.closeBack)==="[object Function]"&&this.closeBack()!==false){var f=this.dialog,i=this.layDic,g=this.iframe,h=d.$(this.elem);if(this.Layer){c(i);c(g)}c(f);if(this.type!=="duli"&&h){c(h);document.body.appendChild(h)}d.removeEvent(window,"resize",this.resize);this.dragKey&&d.removeEvent(this.dragTrigger,"mousedown",this.mousedown);this.autoClose&&this.autoCloseTime&&clearTimeout(this.autoCloseTime)}},drag:function(){var j,q,o,r=document.body,n=document.documentElement,f=this.dragTrigger,i=this.dialog,m,l,p=this;function g(){var s=arguments[0]||window.event;m=s.clientX-d.offset(i).left;l=s.clientY+Math.max(r.scrollTop,n.scrollTop)-d.offset(i).top;this.style.cursor="move";j=document.createElement("div");d.setStyle(j,{width:i.offsetWidth-2+"px",height:i.offsetHeight-2+"px",position:"absolute",top:d.offset(i).top+"px",left:d.offset(i).left+"px",border:"1px dashed #f00",cursor:"move","z-index":99999});document.body.appendChild(j);d.on(document,"mousemove",h);d.on(document,"mouseup",k)}function h(){var v=arguments[0]||window.event,s=Math.min(n.clientWidth,r.clientWidth),u=Math.min(n.clientHeight,r.clientHeight),t=Math.max(r.scrollTop,n.scrollTop);window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();q=v.clientX-m;o=v.clientY+t-l;if(q<0){q=0}if(q+j.offsetWidth>s){q=s-j.offsetWidth}if(o<t){o=t}if(o-t+j.offsetHeight>u){o=t+u-j.offsetHeight}d.setStyle(j,{top:o+"px",left:q+"px"})}function k(){j&&j.parentNode&&j.parentNode.removeChild(j);d.setStyle(i,{position:"absolute",top:o+"px",left:q+"px"});i.style.cursor="";d.removeEvent(document,"mousemove",h);d.removeEvent(document,"mouseup",k)}d.on(f,"mousedown",this.mousedown=g)}};d.dialog=b})(QIE);
