<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=gb2312" />
<title>自动轮替广告</title>
<style type="text/css">
/*advertisement*/
*{margin:0;padding:0;}
.pic_408x144,.pic_408x144 a {
	display:block;
	width:278px;
	height:129px;
	overflow:hidden;
}
.pic_408x144 img{width:278px; height:129px; vertical-align:top}
.pic_numlist {
	height:18px;
	overflow:hidden;
	margin:-15px 2px 0 auto;
	_margin-right:1px;
	position:relative;
	float:right;
	font:12px/14px Simsun;
}
.pic_numlist li {
	display:inline;
	zoom:1;
	padding:0 5px;
	cursor:pointer;
	margin-left:4px;
	color:#333;
	border:1px solid #f60;
}
.pic_numlist .pic_current {
	background-position:-32px -144px;
	color:#fff;
	background:#f60;
}
</style>
</head>
<body>
<div id="adpic" class="pic_408x144">
<?foreach($this->all_data as $v){?>
<?if($v['url']){?>
<a href="<?=$v['url']?>" target=_blank><img src="<?=$v['image_src']?>" width=279 height=129 border=0 ></a>
<?}else{?>
<a href="javascript:void(0)"><img src="<?=$v['image_src']?>" width=279 height=129 border=0 ></a>
<?}?>
<?}?>
</div>
<ul id="adpicBtn" class="pic_numlist"></ul>
<script type="text/javascript">
var isIE=/MSIE/.test(navigator.userAgent);
function $(id){
	return document.getElementById(id);
}
//显示切换广告
window.onload=function(){
	var picContainer=$("adpic")
	var btnContainer=$("adpicBtn");
	var interval=5000;
	var step=isIE?25:5;
	//初始化图片
	var linkList=[];
	var linkListTmp=picContainer.getElementsByTagName("a");
	for (var i=0;i<linkListTmp.length;i++){
		linkListTmp[i].style.display="none";
		linkList.push(linkListTmp[i]);
	}
	var link=document.createElement("a");
	link.style.display="none";
	picContainer.appendChild(link);
	if (!linkList.length)
		return;
	function goAdFunc(i){
		return function(){
			goAd(i);
		};
	}
	if (btnContainer){
		btnContainer.innerHTML="";
		var btnList=[];
		for (var i=0;i<linkList.length;i++){
			var btnTmp=document.createElement("li");
			if (!i)
				btnTmp.className="pic_current";
			btnTmp.innerHTML=i+1;
			btnList.push(btnTmp);
			btnContainer.appendChild(btnTmp);
			btnTmp.onclick=goAdFunc(i);
		}
	}
	var clock,running=false,current=0,next=0,target=null;
	if (isIE){
		picContainer.style.position="relative";
		picContainer.style.filter="progid:DXImageTransform.Microsoft.Fade(duration=1)";
	}
	linkList[current].style.display="";
	function goAd(i){
		if (i!==null){
			if (i==next)
				return;
			else
				target=i;
		}
		clearTimeout(clock);
		if (running)
			return;
		running=true;
		current=next;
		next=(next+1)%linkList.length;
		if (target!==null)
			next=target;
		target=null;
		link.parentNode.insertBefore(linkList[current],link);
		linkList[current].style.position="relative";
		linkList[next].style.position="absolute";
		linkList[next].style.display="";
		btnList[current].className="";
		btnList[next].className="pic_current";
		function transComplete(){
			linkList[current].style.display="none";
			linkList[current].style.filter="";
			running=false;
			clock=setTimeout(function(){
				goAd(null);
			},target===null?interval:200);
		}
		if (isIE){
			picContainer.filters[0].apply();
			linkList[current].style.display="none";
			picContainer.filters[0].play();
			transComplete();
		}else{
			var alpha=100;
			var iClock=setInterval(function(){
				alpha=Math.max(alpha-step,0);
				linkList[current].style.opacity=alpha/100;
				linkList[current].style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+alpha+")";
				if (!alpha){
					clearInterval(iClock);
					linkList[current].style.opacity=100;
					transComplete();
				}
			},20);
		}
	}
	clock=setTimeout(function(){
		goAd(null);
	},interval);
};
</script>
</body>
</html>